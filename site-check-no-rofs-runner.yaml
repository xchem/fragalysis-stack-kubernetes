---

# A play that can be used to check Pods in a given cluster for
# read-only filesystem issues. The play uses a map of volumes
# and the Pods that use them. The play will attempt to write
# to the volume, reporting any that cannot be touched.
#
# You can use delete_failed_pods to also delete Pods that fail.

- hosts: playbook-runner
  vars:
    ansible_python_interpreter: /usr/local/bin/python3.11
  tasks:
  - name: Run check-no-rofs (dev)
    command: ansible-playbook site-check-no-rofs.yaml -e cluster=dev
    environment:
      KUBECONFIG: /home/wmu55374/.kube/config-dev
      PATH: /home/wmu55374/.local/bin:{{ ansible_env.PATH }}
    args:
      chdir: fragalysis-stack-kubernetes
  - name: Run check-no-rofs (prod)
    command: ansible-playbook site-check-no-rofs.yaml -e cluster=prod
    environment:
      KUBECONFIG: /home/wmu55374/.kube/config-prod
      PATH: /home/wmu55374/.local/bin:{{ ansible_env.PATH }}
    args:
      chdir: fragalysis-stack-kubernetes
